<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NEON Airborne Remote Sensing in GEE Workshop"><meta name=author content="Samapriya Roy"><link href=../01_intro_to_neon_aop_gee_datasets/ rel=prev><link href=../03_plot_spectral_signature/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Reflectance pre-processing masking out bad weather data in GEE - NEON @ ESA 2025</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRegular:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Google Sans";--md-code-font:"Regular"}</style><link rel=stylesheet href=../../css/timeago.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link rel=stylesheet href=../../assets/stylesheets/custom.f7ec4df2.min.css><style>
    .content-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .workshop-content {
        color: #fff;
        text-align: center;
    }

    .workshop-link {
        color: #fff;
        text-decoration: none;
        font-weight: bold;
    }

    .workshop-link:hover {
        text-decoration: underline;
    }

    /* Floating Survey Button */
    .floating-survey-button {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background-color: #000 !important;
        color: #fff !important;
        padding: 10px 20px;
        border-radius: 50px;
        display: flex;
        align-items: center;
        text-decoration: none !important;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s;
        cursor: pointer;
        z-index: 1000;
    }

    .floating-survey-button:hover {
        background-color: #333 !important;
        color: #fff !important;
        text-decoration: none !important;
    }

    .floating-survey-button:visited {
        color: #fff !important;
    }

    .floating-survey-button:link {
        color: #fff !important;
    }

    .floating-survey-button:active {
        color: #fff !important;
    }

    /* Ensure the span inside also has white text */
    .floating-survey-button span {
        color: #fff !important;
    }

    /* Optional: Add an icon placeholder if you want to add one later */
    .floating-survey-button::before {
        content: "📋";
        margin-right: 8px;
        font-size: 18px;
    }
</style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#reflectance-pre-processing-masking-out-bad-weather-data-in-gee class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <div class=content-container> <div class=workshop-content> <strong>Join Us Tomorrow:</strong> <a href=https://events.rdmobile.com/Sessions/Details/2967238 class=workshop-link> Enhancing NEON User Experience Workshop - Thursday, Aug 14, 8:00-9:30 AM EDT </a> </div> </div> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="NEON @ ESA 2025" class="md-header__button md-logo" aria-label="NEON @ ESA 2025" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> NEON @ ESA 2025 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Reflectance pre-processing masking out bad weather data in GEE </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/spatialbytes/neon-esa-docs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> neon-esa-docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="NEON @ ESA 2025" class="md-nav__button md-logo" aria-label="NEON @ ESA 2025" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> NEON @ ESA 2025 </label> <div class=md-nav__source> <a href=https://github.com/spatialbytes/neon-esa-docs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> neon-esa-docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../neon-aop-gee/ class=md-nav__link> <span class=md-ellipsis> About This Project </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Background </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Background </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../background/neon_background/ class=md-nav__link> <span class=md-ellipsis> NEON Overview </span> </a> </li> <li class=md-nav__item> <a href=../../background/aop_background/ class=md-nav__link> <span class=md-ellipsis> AOP Overview </span> </a> </li> <li class=md-nav__item> <a href=../../gee/gee_overview/ class=md-nav__link> <span class=md-ellipsis> Earth Engine Overview </span> </a> </li> <li class=md-nav__item> <a href=../../background/neon_aop_gee_data/ class=md-nav__link> <span class=md-ellipsis> NEON AOP Data in GEE </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../setup/getting_started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Google Earth Engine Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Google Earth Engine Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gee/gee_catalog/ class=md-nav__link> <span class=md-ellipsis> Earth Engine Catalog </span> </a> </li> <li class=md-nav__item> <a href=../../gee/gee_community_catalog/ class=md-nav__link> <span class=md-ellipsis> Earth Engine Community Catalog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Tutorials & Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Tutorials & Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01_intro_to_neon_aop_gee_datasets/ class=md-nav__link> <span class=md-ellipsis> Introduction to AOP Public Datasets in Google Earth Engine (GEE) </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Reflectance pre-processing masking out bad weather data in GEE </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Reflectance pre-processing masking out bad weather data in GEE </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#objectives class=md-nav__link> <span class=md-ellipsis> Objectives </span> </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> <span class=md-ellipsis> Requirements </span> </a> </li> <li class=md-nav__item> <a href=#read-in-the-aop-surface-directional-reflectance-2019-dataset-at-soap class=md-nav__link> <span class=md-ellipsis> Read in the AOP Surface Directional Reflectance 2019 Dataset at SOAP </span> </a> </li> <li class=md-nav__item> <a href=#display-the-qa-bands class=md-nav__link> <span class=md-ellipsis> Display the QA Bands </span> </a> </li> <li class=md-nav__item> <a href=#read-in-the-weather-quality-indicator-band class=md-nav__link> <span class=md-ellipsis> Read in the Weather Quality Indicator Band </span> </a> </li> <li class=md-nav__item> <a href=#plot-the-weather-quality-band-data class=md-nav__link> <span class=md-ellipsis> Plot the Weather Quality Band Data </span> </a> </li> <li class=md-nav__item> <a href=#plot-the-clear-weather-reflectance-data class=md-nav__link> <span class=md-ellipsis> Plot the Clear-Weather Reflectance Data </span> </a> </li> <li class=md-nav__item> <a href=#plot-acquisition-dates class=md-nav__link> <span class=md-ellipsis> Plot Acquisition Dates </span> </a> </li> <li class=md-nav__item> <a href=#other-qa-considerations class=md-nav__link> <span class=md-ellipsis> Other QA Considerations </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#get-lesson-code class=md-nav__link> <span class=md-ellipsis> Get Lesson Code </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../03_plot_spectral_signature/ class=md-nav__link> <span class=md-ellipsis> Plot spectral signatures of AOP Reflectance data in GEE </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#objectives class=md-nav__link> <span class=md-ellipsis> Objectives </span> </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> <span class=md-ellipsis> Requirements </span> </a> </li> <li class=md-nav__item> <a href=#read-in-the-aop-surface-directional-reflectance-2019-dataset-at-soap class=md-nav__link> <span class=md-ellipsis> Read in the AOP Surface Directional Reflectance 2019 Dataset at SOAP </span> </a> </li> <li class=md-nav__item> <a href=#display-the-qa-bands class=md-nav__link> <span class=md-ellipsis> Display the QA Bands </span> </a> </li> <li class=md-nav__item> <a href=#read-in-the-weather-quality-indicator-band class=md-nav__link> <span class=md-ellipsis> Read in the Weather Quality Indicator Band </span> </a> </li> <li class=md-nav__item> <a href=#plot-the-weather-quality-band-data class=md-nav__link> <span class=md-ellipsis> Plot the Weather Quality Band Data </span> </a> </li> <li class=md-nav__item> <a href=#plot-the-clear-weather-reflectance-data class=md-nav__link> <span class=md-ellipsis> Plot the Clear-Weather Reflectance Data </span> </a> </li> <li class=md-nav__item> <a href=#plot-acquisition-dates class=md-nav__link> <span class=md-ellipsis> Plot Acquisition Dates </span> </a> </li> <li class=md-nav__item> <a href=#other-qa-considerations class=md-nav__link> <span class=md-ellipsis> Other QA Considerations </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#get-lesson-code class=md-nav__link> <span class=md-ellipsis> Get Lesson Code </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/spatialbytes/neon-esa-docs/edit/master/docs/tutorials/02_neon_reflectance_weather_qa.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/spatialbytes/neon-esa-docs/raw/master/docs/tutorials/02_neon_reflectance_weather_qa.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=reflectance-pre-processing-masking-out-bad-weather-data-in-gee>Reflectance Pre-processing: Masking Out Bad Weather Data in GEE<a class=headerlink href=#reflectance-pre-processing-masking-out-bad-weather-data-in-gee title="Permanent link">&para;</a></h1> <div class="admonition info"> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=reflectance-pre-processing-masking-out-bad-weather-data-in-gee--tutorial-details name=__tabbed_1 type=radio><input id=reflectance-pre-processing-masking-out-bad-weather-data-in-gee--topics--data name=__tabbed_1 type=radio><div class=tabbed-labels><label for=reflectance-pre-processing-masking-out-bad-weather-data-in-gee--tutorial-details>📋 Tutorial Details</label><label for=reflectance-pre-processing-masking-out-bad-weather-data-in-gee--topics--data>🏷️ Topics &amp; Data</label></div> <div class=tabbed-content> <div class=tabbed-block> <ul> <li><strong>Duration:</strong> 30 minutes</li> <li><strong>Level:</strong> Intermediate</li> <li><strong>Authors:</strong> Bridget M. Hass, John Musinsky</li> <li><strong>Contributors:</strong> Tristan Goulden</li> </ul> </div> <div class=tabbed-block> <ul> <li><strong>Topics:</strong> hyperspectral, remote-sensing</li> <li><strong>Data Product:</strong> DP3.30006.001</li> </ul> </div> </div> </div> </div> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>Since reflectance data is generated from a passive energy source (the sun), data collected in cloudy sky conditions are not directly comparable to data collected in clear-sky conditions, as overhead clouds can obscure the incoming light source. AOP aims to collect data only in optimal (&lt;10% cloud-cover) weather conditions, but cannot always do so due to logistical constraints. The flight operators record the weather conditions during each flight, and this information is passed through to the final data product at the level of the flight line (as cloud conditions can change throughout the day).</p> <p>Cloud conditions are reported as: - <strong>Green</strong> (&lt;10% cloud cover) - <strong>Yellow</strong> (10-50% cloud cover) - <strong>Red</strong> (&gt;50% cloud cover)</p> <p>The figure below shows some examples of what the cloud conditions look like at different flights collected in the three different weather classes.</p> <p><img alt="In-flight cloud photos" src=https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/graphics/aop-gee2023/1b_sdr_weather/flight_cloud_photos.png> <em>Cloud cover percentage during AOP flights. Left: green (&lt;10%), Middle: yellow (10-50%), Right: red (&gt;50%).</em></p> <div class="admonition note"> <p class=admonition-title>Airborne vs. Satellite Data</p> <p>There is an important distinction between airborne and satellite reflectance data. Satellite data is collected in all weather conditions, and the clouds are below the sensor, so algorithms can be generated to filter out cloudy pixels. With aerial data, we have more control over when the data are collected, to a degree. However, clouds may be present overhead, if it were deemed necessary to collect in sub-optimal weather conditions. AOP typically will only collect in "red" sky conditions if we are running out of time in a Domain and the weather isn't forecasted to improve.</p> </div> <p>Since the clouds won't appear in the actual data, maintaining this record of cloud conditions is essential for properly understanding the data, and using it for change detection or other research applications. For a more direct comparison of reflectance values, we recommend only working with the clear-weather data. This lesson outlines how to do this in GEE.</p> <h2 id=objectives>Objectives<a class=headerlink href=#objectives title="Permanent link">&para;</a></h2> <p>After completing this activity, you will be able to:</p> <ul> <li>Extract and plot the weather quality indicator band from the Surface Directional Reflectance dataset</li> <li>Mask reflectance data to pull out only clear-weather data for a given site</li> <li>Explore other QA bands included in the Reflectance data set</li> </ul> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">&para;</a></h2> <ul> <li>Complete the following introductory AOP GEE tutorials:<ul> <li><a href=https://www.neonscience.org/resources/learning-hub/tutorials/intro-aop-gee-image-collections>Introduction to AOP Public Datasets in Google Earth Engine (GEE)</a></li> </ul> </li> <li>An understanding of hyperspectral data and AOP spectral data products. If this is your first time working with AOP hyperspectral data, we encourage you to start with:<ul> <li><a href=https://www.neonscience.org/resources/learning-hub/tutorials/hsi-hdf5-r>Intro to Working with Hyperspectral Remote Sensing Data in R</a>. You do not need to follow along with the code in those lessons, but at least read through to gain a better understanding of NEON's hyperspectral data product.</li> </ul> </li> </ul> <h2 id=read-in-the-aop-surface-directional-reflectance-2019-dataset-at-soap>Read in the AOP Surface Directional Reflectance 2019 Dataset at SOAP<a class=headerlink href=#read-in-the-aop-surface-directional-reflectance-2019-dataset-at-soap title="Permanent link">&para;</a></h2> <p>For this exercise, we will read in directional reflectance data from the NEON site <a href=https://www.neonscience.org/field-sites/soap>Soaproot Saddle (SOAP)</a> collected in 2019:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Filter image collection by date and site to pull out a single image</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kd>var</span><span class=w> </span><span class=nx>soapSDR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ee</span><span class=p>.</span><span class=nx>ImageCollection</span><span class=p>(</span><span class=s2>&quot;projects/neon-prod-earthengine/assets/HSI_REFL/001&quot;</span><span class=p>)</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span><span class=p>.</span><span class=nx>filterDate</span><span class=p>(</span><span class=s1>&#39;2019-01-01&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-31&#39;</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span><span class=p>.</span><span class=nx>filterMetadata</span><span class=p>(</span><span class=s1>&#39;NEON_SITE&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;equals&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;SOAP&#39;</span><span class=p>)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>  </span><span class=p>.</span><span class=nx>first</span><span class=p>();</span>
</span></code></pre></div> <h2 id=display-the-qa-bands>Display the QA Bands<a class=headerlink href=#display-the-qa-bands title="Permanent link">&para;</a></h2> <p>From the previous lesson, recall that the reflectance images include 442 bands. Bands 0-425 are the data bands, which store the spectral reflectance values for each wavelength recorded by the NEON Imaging Spectrometer (NIS). The remaining bands (426-441) contain metadata and QA information that are important for understanding and properly interpreting the hyperspectral data. The data bands all follow the naming convention B001, B002, ..., B426, and the QA bands have more descriptive names that start with something other than the letter "B", so we can use that information to extract the QA bands.</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// Pull out and display only the qa bands (these all start with something other than B)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=c1>// &#39;[^B].*&#39; is a regular expression to pull out bands that don&#39;t start with B</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=kd>var</span><span class=w> </span><span class=nx>soapSDR_qa</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapSDR</span><span class=p>.</span><span class=nx>select</span><span class=p>(</span><span class=s1>&#39;[^B].*&#39;</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=nx>print</span><span class=p>(</span><span class=s1>&#39;QA Bands&#39;</span><span class=p>,</span><span class=nx>soapSDR_qa</span><span class=p>)</span>
</span></code></pre></div> <p><img alt="Reflectance QA Bands" src=https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/graphics/aop-gee2023/1b_sdr_weather/qa_bands.PNG></p> <p>Most of these QA bands are inputs to and outputs from the Atmospheric Correction (ATCOR), the process which converts radiance to atmospherically corrected reflectance. We will elaborate on these QA bands further, and encourage you to read more details about these data in the <a href="https://data.neonscience.org/api/v0/documents/NEON.DOC.001288vB?inline=true">NEON Imaging Spectrometer Radiance to Reflectance Algorithm Theoretical Basis Document</a>. For the purposes of this exercise, we will focus on the Weather Quality Indicator band.</p> <div class="admonition tip"> <p class=admonition-title>Exploring Other QA Bands</p> <p>Note that you can explore each of the QA bands, following similar steps below, adjusting the band names and values accordingly.</p> </div> <h2 id=read-in-the-weather-quality-indicator-band>Read in the Weather Quality Indicator Band<a class=headerlink href=#read-in-the-weather-quality-indicator-band title="Permanent link">&para;</a></h2> <p>The weather information, called <code>Weather_Quality_Indicator</code> is one of the most important pieces of QA information that is collected about the NIS data, as it has a direct impact on the reflectance values.</p> <p>These next lines of code pull out the <code>Weather_Quality_Indicator</code> band, select the "green" weather data from that band, and apply a mask to keep only the clear-weather data, which is saved to the variable <code>soapSDR_clear</code>.</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// Extract a single band Weather Quality QA layer</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kd>var</span><span class=w> </span><span class=nx>soapWeather</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapSDR</span><span class=p>.</span><span class=nx>select</span><span class=p>([</span><span class=s1>&#39;Weather_Quality_Indicator&#39;</span><span class=p>]);</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1>// Select only the clear weather data (&lt;10% cloud cover)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=kd>var</span><span class=w> </span><span class=nx>soapClearWeather</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapWeather</span><span class=p>.</span><span class=nx>eq</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=c1>// 1 = 0-10% cloud cover</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1>// Mask out all cloudy pixels from the SDR image</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=kd>var</span><span class=w> </span><span class=nx>soapSDR_clear</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapSDR</span><span class=p>.</span><span class=nx>updateMask</span><span class=p>(</span><span class=nx>soapClearWeather</span><span class=p>);</span>
</span></code></pre></div> <h2 id=plot-the-weather-quality-band-data>Plot the Weather Quality Band Data<a class=headerlink href=#plot-the-weather-quality-band-data title="Permanent link">&para;</a></h2> <p>For reference, we can plot the weather band data, using AOP's stop-light (red/yellow/green) color scheme, with the code below:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>// center the map at the lat / lon of the site, set zoom to 12</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nb>Map</span><span class=p>.</span><span class=nx>setCenter</span><span class=p>(</span><span class=o>-</span><span class=mf>119.25</span><span class=p>,</span><span class=w> </span><span class=mf>37.06</span><span class=p>,</span><span class=w> </span><span class=mf>11</span><span class=p>);</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1>// Define a palette for the weather - to match NEON AOP&#39;s weather color conventions</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=kd>var</span><span class=w> </span><span class=nx>gyrPalette</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>  </span><span class=s1>&#39;00ff00&#39;</span><span class=p>,</span><span class=w> </span><span class=c1>// green (&lt;10% cloud cover)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>  </span><span class=s1>&#39;ffff00&#39;</span><span class=p>,</span><span class=w> </span><span class=c1>// yellow (10-50% cloud cover)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>  </span><span class=s1>&#39;ff0000&#39;</span><span class=w> </span><span class=c1>// red (&gt;50% cloud cover)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=p>];</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=c1>// Display the weather band (cloud conditions) with the green-yellow-red palette</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=nb>Map</span><span class=p>.</span><span class=nx>addLayer</span><span class=p>(</span><span class=nx>soapWeather</span><span class=p>,</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>             </span><span class=p>{</span><span class=nx>min</span><span class=o>:</span><span class=w> </span><span class=mf>1</span><span class=p>,</span><span class=w> </span><span class=nx>max</span><span class=o>:</span><span class=w> </span><span class=mf>3</span><span class=p>,</span><span class=w> </span><span class=nx>palette</span><span class=o>:</span><span class=w> </span><span class=nx>gyrPalette</span><span class=p>,</span><span class=w> </span><span class=nx>opacity</span><span class=o>:</span><span class=w> </span><span class=mf>0.3</span><span class=p>},</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>             </span><span class=s1>&#39;SOAP 2019 Cloud Cover Map&#39;</span><span class=p>);</span>
</span></code></pre></div> <h2 id=plot-the-clear-weather-reflectance-data>Plot the Clear-Weather Reflectance Data<a class=headerlink href=#plot-the-clear-weather-reflectance-data title="Permanent link">&para;</a></h2> <p>Finally, we can plot a true-color image of only the clear-weather data, from <code>soapSDR_clear</code> that we created earlier:</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>// Create a 3-band cloud-free image</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kd>var</span><span class=w> </span><span class=nx>soapSDR_RGB</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapSDR_clear</span><span class=p>.</span><span class=nx>select</span><span class=p>([</span><span class=s1>&#39;B053&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;B035&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;B019&#39;</span><span class=p>]);</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1>// Display the SDR image</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=nb>Map</span><span class=p>.</span><span class=nx>addLayer</span><span class=p>(</span><span class=nx>soapSDR_RGB</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=nx>min</span><span class=o>:</span><span class=mf>103</span><span class=p>,</span><span class=w> </span><span class=nx>max</span><span class=o>:</span><span class=mf>1160</span><span class=p>},</span><span class=w> </span><span class=s1>&#39;SOAP 2019 Reflectance RGB&#39;</span><span class=p>);</span>
</span></code></pre></div> <p><img alt="GEE Map of SOAP Weather Quality Map and Clear Reflectance Data" src=https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/graphics/aop-gee2023/1b_sdr_weather/soap_clear_sdr_weather_map.PNG></p> <h2 id=plot-acquisition-dates>Plot Acquisition Dates<a class=headerlink href=#plot-acquisition-dates title="Permanent link">&para;</a></h2> <p>We can apply the same concepts to explore another one of the QA bands, this time let's look at the <code>Acquisition_Date</code>. This may be useful if you are trying to find the dates that correspond to field data you've collected, or you want to scale up to satellite data, for example. To determine the minimum and maximum dates, you can use <code>reduceRegion</code> with the reducer <code>ee.Reducer.minMax()</code> as follows. Then use these start and end date values in the visualization parameters.</p> <div class="admonition tip"> <p class=admonition-title>Managing Layer Display</p> <p>You may not wish to show every layer by default if you are plotting many layers. You can choose not to display a layer by default by including a "0" as the last input of <code>Map.addLayer</code>. Once you run the code, to toggle the layer on, find the <strong>Layers</strong> tab in the upper right corner of the Map Window and check the box to the left of the layer you want to display. You can click on the lock icon to make it so that the Layers full display stays open (by default it minimizes).</p> </div> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>// Extract acquisition dates QA band</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kd>var</span><span class=w> </span><span class=nx>soapDates</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapSDR</span><span class=p>.</span><span class=nx>select</span><span class=p>([</span><span class=s1>&#39;Acquisition_Date&#39;</span><span class=p>]);</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=c1>// Get the minimum and maximum values of the soapDates band</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=kd>var</span><span class=w> </span><span class=nx>minMaxValues</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>soapDates</span><span class=p>.</span><span class=nx>reduceRegion</span><span class=p>({</span><span class=nx>reducer</span><span class=o>:</span><span class=w> </span><span class=nx>ee</span><span class=p>.</span><span class=nx>Reducer</span><span class=p>.</span><span class=nx>minMax</span><span class=p>(),</span><span class=nx>maxPixels</span><span class=o>:</span><span class=w> </span><span class=mf>1e10</span><span class=p>})</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nx>print</span><span class=p>(</span><span class=s1>&#39;min and max dates&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>minMaxValues</span><span class=p>);</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=c1>// Map acquisition dates, don&#39;t display layer by default</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=nb>Map</span><span class=p>.</span><span class=nx>addLayer</span><span class=p>(</span><span class=nx>soapDates</span><span class=p>,</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>            </span><span class=p>{</span><span class=nx>min</span><span class=o>:</span><span class=mf>20190612</span><span class=p>,</span><span class=w> </span><span class=nx>max</span><span class=o>:</span><span class=mf>20190616</span><span class=p>,</span><span class=w> </span><span class=nx>opacity</span><span class=o>:</span><span class=w> </span><span class=mf>0.5</span><span class=p>},</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>            </span><span class=s1>&#39;SOAP 2019 Acquisition Dates&#39;</span><span class=p>,</span><span class=mf>0</span><span class=p>);</span>
</span></code></pre></div> <p><img alt="SOAP 2019 Acquisition Dates" src=https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/graphics/aop-gee2023/1b_sdr_weather/soap_acquisition_dates.PNG></p> <h2 id=other-qa-considerations>Other QA Considerations<a class=headerlink href=#other-qa-considerations title="Permanent link">&para;</a></h2> <p>This lesson is intended to give you a quick introduction to some of the QA factors to consider when working with NEON AOP data, and is not meant to be comprehensive. When working with hyperspectral data, there are also invalid and noisy bands that you will likely want to remove before working with the full spectra (these bad bands are not unique to NEON hyperspectral data; for example NASA AVIRIS and EMIT hyperspectral data have the same limitations).</p> <div class="admonition note"> <p class=admonition-title>Additional Resources</p> <p>Please see the lesson <a href=https://www.neonscience.org/resources/learning-hub/tutorials/aop-gee-plot-spectra>Plot spectral signatures of AOP Reflectance data in GEE</a> for more details on these "bad bands". The Algorithm Theoretical Basis Documents (ATBDs) for the directional and bidirectional reflectance datasets, linked from the NEON Data Product Pages (<a href=https://data.neonscience.org/data-products/DP3.30006.001>DP3.30006.001</a>, <a href=https://data.neonscience.org/data-products/DP3.30006.002>DP3.30006.002</a>) and from the Quick Start Guides linked in the descriptions in the <a href=https://developers.google.com/earth-engine/datasets/publisher/neon-prod-earthengine>NEON Publisher Datasets</a> pages on GEE, provide more comprehensive details on how these data products were derived and additional QA factors to consider.</p> </div> <p>When pairing NEON data with satellite data, you will also need to factor in differences in how the datasets were processed, such as the atmospheric correction algorithm used, and other corrections that may or may not be applied (e.g. BRDF and topographic corrections) to both/all datasets you are integrating. If you can't find the information you need in the documentation, please reach out to NEON scientists using the <a href=https://www.neonscience.org/about/contact-us>NEON Contact Us</a> form with any questions.</p> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>In this lesson you learned how to read in Weather Quality Information from the Reflectance QA bands in GEE. You learned to mask data to keep only the imagery collected in the clearest sky conditions (&lt;10% cloud cover), and plot the three weather quality classes. You also learned how to find the other QA bands. Following a similar approach, you can explore each of the QA bands similarly. Filtering by the weather quality is an important first pre-processing step to working with NEON hyperspectral data, and is essential for interpreting the data and carrying out subsequent data analysis.</p> <h2 id=get-lesson-code>Get Lesson Code<a class=headerlink href=#get-lesson-code title="Permanent link">&para;</a></h2> <p><a href=https://code.earthengine.google.com/3b9f43d1e1baefab5ceabc6a59d03b51>AOP GEE SDR Weather Quality</a></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 4, 2025 20:52:18 UTC"><span class=timeago datetime=2025-08-04T20:52:18+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 4, 2025 20:52:18 UTC">2025-08-04</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 4, 2025 20:39:54 UTC"><span class=timeago datetime=2025-08-04T20:39:54+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 4, 2025 20:39:54 UTC">2025-08-04</span> </span> </aside> <!-- Floating Survey Button --> <a href=https://docs.google.com/forms/d/e/1FAIpQLSfYKQAgxGdDpIfPU96YdgCc2HBuh2oCAF9_Zz4ywrzZfi4gJg/viewform class=floating-survey-button target=_blank rel="noopener noreferrer"> <span>Take the Survey</span> </a> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Samapriya Roy </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/samapriya target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://www.linkedin.com/in/samapriya target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://medium.com/@samapriyaroy target=_blank rel=noopener title=medium.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M369.4 32c43.4 0 78.6 35.2 78.6 78.6v83.8c-1.9-.1-3.8-.2-5.7-.2h-.4c-10 0-22.3 2.4-31.1 6.8-10 4.6-18.7 11.5-26 20.6-11.8 14.6-18.9 34.3-20.6 56.4-.1.7-.1 1.3-.2 2s-.1 1.2-.1 1.9c-.1 1.2-.1 2.4-.1 3.6 0 1.9-.1 3.8 0 5.8 1.2 50.1 28.2 90.2 76.3 90.2 2.7 0 5.3-.1 7.9-.4v20.4c0 43.4-35.2 78.6-78.6 78.6L78.6 480C35.2 480 0 444.8 0 401.4V110.6C0 67.2 35.2 32 78.6 32zM82.3 138.9l.3.1c13.2 3 19.8 7.4 19.8 23.4v187.2c0 16-6.7 20.4-19.9 23.4l-.3.1v2.8H135v-2.8l-.3-.1c-13.2-3-19.9-7.4-19.9-23.4V173.3l86.1 202.5h4.9l88.6-208.2v186.6c-1.1 12.6-7.8 16.5-19.7 19.2l-.3.1v2.7h91.9v-2.7l-.3-.1c-11.9-2.7-18.7-6.6-19.9-19.2l-.1-191.8h.1c0-16 6.7-20.4 19.9-23.4l.3-.1v-2.7h-72.2l-67 157.4-67-157.4H82.3zM448 340.3c-25.1-7.4-43-35.1-41.2-67.8h41.1v67.8zm-6.4-135.6c2.3 0 4.4.3 6.4.9V263h-40.2c1.5-33.6 13.6-57.9 33.8-58.3"/></svg> </a> <a href=https://mapstodon.space/@samapriya target=_blank rel="noopener me" title=mapstodon.space class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href=https://twitter.com/samapriyaroy target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.50899def.min.js></script> <script src=../../js/timeago.min.js></script> <script src=../../js/timeago_mkdocs_material.js></script> <script src=../../js/open_in_new_tab.js></script> <script src=../../assets/javascripts/custom.a678ee80.min.js></script> </body> </html>